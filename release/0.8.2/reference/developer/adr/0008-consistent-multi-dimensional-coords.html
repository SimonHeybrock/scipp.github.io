<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADR 0008: Consistent multi-dimensional coords &mdash; scipp  documentation</title>
      <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ADR 0009: Handle dimensionless as non-counts" href="0009-handle-dimensionless-as-non-counts.html" />
    <link rel="prev" title="ADR 0007: Do not support arguments referring to x or y" href="0007-do-not-support-args-referencing-x-or-y.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo-large-v4.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/quick-start.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/data-structures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/slicing.html">Slicing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/computation.html">Computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/masking.html">Masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/binned-data.html">Binned Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/groupby.html">GroupBy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/coordinate-transformations.html">Coordinate transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/reading-and-writing-files.html">Reading and Writing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/how_to.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/tips-tricks-and-anti-patterns.html">Tips, tricks, and anti-patterns</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Visualization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/representations-and-tables.html">Representations and Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/plotting-overview.html">Plotting Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/plotting-in-depth.html">Plotting in depth</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html#creation-functions">Creation functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html#free-functions">Free functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html#modules">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linear-algebra.html">Linear Algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dtype.html">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../units.html">Physical units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../error-propagation.html">Propagation of uncertainties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../runtime-configuration.html">Runtime Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../developer-documentation.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../architecture-decision-records.html">Architecture Decision Records</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0001-remove-dataset-masking-support.html">ADR 0001: Remove dataset masking support</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002-remove-instrument-view-projection-options.html">ADR 0002: Remove instrument view 2D projection options</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003-refactor-plotting-code-with-mvc-pattern.html">ADR 0003: Refactor plotting code to use Model-View-Controller design pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-use-ipympl-backend-for-matplotlib.html">ADR 0004: Use the ipympl backend for Matplotlib figures in Jupyter</a></li>
<li class="toctree-l3"><a class="reference internal" href="0005-remove-need-for-bins-property-when-calling-bin-or-histogram.html">ADR 0005: Remove need for <code class="docutils literal notranslate"><span class="pre">bins</span></code> property when calling <code class="docutils literal notranslate"><span class="pre">bin</span></code> or <code class="docutils literal notranslate"><span class="pre">histogram</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="0006-add-readonly-flags.html">ADR 0006: Add read-only flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007-do-not-support-args-referencing-x-or-y.html">ADR 0007: Do not support arguments referring to <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ADR 0008: Consistent multi-dimensional coords</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decision">Decision</a></li>
<li class="toctree-l4"><a class="reference internal" href="#consequences">Consequences</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0009-handle-dimensionless-as-non-counts.html">ADR 0009: Handle dimensionless as non-counts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../coding-conventions.html">Coding conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../constructing_variables.html">C++ API for constructing variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../customizing.html">Customizing Scipp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dependencies.html">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to.html">How To…</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tooling.html">Tooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transform.html">Transforming data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../variable_implementation.html">Implementation of class Variable</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/introduction.html">1-D datasets and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/multi-d-datasets.html">Multi-dimensional datasets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/about.html">About scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/whats-new.html">What’s new in scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/contributing.html">Contributing to scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/release-notes.html">Release Notes</a></li>
</ul>

    <div style="height: 32px; position: fixed; bottom: 0; left: 15px;">
      Select version:&nbsp;
      <select onchange="location = this.value;"
              style="height: 30px; color: #27a54b; background-color: #403d3d;
                    border: 0px; box-shadow: none;">
        <option value="" selected>Pick version</option>
        <option value="https://scipp.github.io">latest (unstable)</option>
        <option value="https://scipp.github.io/release/0.8.2">v0.8</option>
        <option value="https://scipp.github.io/release/0.7.1">v0.7</option>
        <option value="https://scipp.github.io/release/0.6.1">v0.6</option>
        <option value="https://scipp.github.io/release/0.5.0">v0.5</option>
        <option value="https://scipp.github.io/release/0.4.0">v0.4</option>
        <option value="https://scipp.github.io/release/0.3.0">v0.3</option>
      </select>
    </div>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">scipp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../developer-documentation.html">Developer Documentation</a> &raquo;</li>
          <li><a href="../architecture-decision-records.html">Architecture Decision Records</a> &raquo;</li>
      <li>ADR 0008: Consistent multi-dimensional coords</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/reference/developer/adr/0008-consistent-multi-dimensional-coords.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="adr-0008-consistent-multi-dimensional-coords">
<h1>ADR 0008: Consistent multi-dimensional coords<a class="headerlink" href="#adr-0008-consistent-multi-dimensional-coords" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Status: accepted</p></li>
<li><p>Deciders: Jan-Lukas, Neil, Owen, Simon</p></li>
<li><p>Date: 2021-08-19</p></li>
</ul>
<div class="section" id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>In the special case of non-dimension coords that have more than 1 dimension, they are considered to be labels for their inner dimension.
This causes trouble in many cases, e.g., after computation of <code class="docutils literal notranslate"><span class="pre">phi</span></code> and <code class="docutils literal notranslate"><span class="pre">radius</span></code> for 2-D data from <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> coords.
If for example <code class="docutils literal notranslate"><span class="pre">phi.dims</span> <span class="pre">=</span> <span class="pre">['x',</span> <span class="pre">'y']</span></code> and <code class="docutils literal notranslate"><span class="pre">radius.dims</span> <span class="pre">=</span> <span class="pre">['y',</span> <span class="pre">'x']</span></code> then an <code class="docutils literal notranslate"><span class="pre">x</span></code> slice will:</p>
<ul class="simple">
<li><p>Convert <code class="docutils literal notranslate"><span class="pre">radius</span></code> to an attribute because it is considered a coordinate of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p>Keep <code class="docutils literal notranslate"><span class="pre">phi</span></code> as a coordinate because it is considered a coordinate of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
</ul>
<p>However, for such coords it is just coincidence what its inner dimension is — it isn’t labelling either of the dims (or both, after slicing).</p>
<p>The conclusion seems to be that the current definition is wrong.
In the above example the expected outcome would be that radius and phi behave in the same manner, and that slicing along x or y behaves the same, i.e., either both or neither of radius and phi should turn into attributes.</p>
<p>A related limitation is that currently bin-edges must be edges for their inner dimension, because for dimension coords the matching coord key overrides which dimension the coord is associated with.
As a consequence such a bin-edge coord exceeds the data dims in a dimension other than its associated dimension, which is not valid, raising an exception.</p>
</div>
<div class="section" id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Permalink to this headline">¶</a></h2>
<p>Do not associate multi-dimension coords with a dimension, unless:</p>
<ul class="simple">
<li><p>It is a bin-edge coord, in which case it gets associated with the bin-edge dimension.</p></li>
<li><p>It is not a bin-edge coord, but a dimension coord, and gets associated with the coord key.</p></li>
</ul>
</div>
<div class="section" id="consequences">
<h2>Consequences<a class="headerlink" href="#consequences" title="Permalink to this headline">¶</a></h2>
<div class="section" id="positive">
<h3>Positive:<a class="headerlink" href="#positive" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fix inconsistent behavior.</p></li>
<li><p>Bin-edges work as expected in more cases.</p></li>
<li><p>Transposing is not necessary any more to work around limitations.</p></li>
<li><p>Reduction operations now drop multi-dimensional coords that depend on the reduction dimension.
This makes the operations more flexible while at the same time ensuring consistency, by dropping rather than preserving the coordinate.
Note that in rare cases this may lead to undesirable consequences, e.g., if the result of the reduction is later added to another array where the coord is present, which would be wrong.</p></li>
</ul>
</div>
<div class="section" id="negative">
<h3>Negative:<a class="headerlink" href="#negative" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>It is no longer possible to define an associated dimension for multi-dimensional coords that label a particular dimension.</p></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0007-do-not-support-args-referencing-x-or-y.html" class="btn btn-neutral float-left" title="ADR 0007: Do not support arguments referring to x or y" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="0009-handle-dimensionless-as-non-counts.html" class="btn btn-neutral float-right" title="ADR 0009: Handle dimensionless as non-counts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 Scipp contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
    <style>
      .wy-nav-content { max-width: 1100px; }
    </style>
  

</body>
</html>