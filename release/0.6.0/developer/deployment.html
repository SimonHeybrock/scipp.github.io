

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Deployment &mdash; scipp  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="About scipp" href="../about/about.html" />
    <link rel="prev" title="ADR 0005: Remove need for bins property when calling bin or histogram" href="adr/0005-remove-need-for-bins-property-when-calling-bin-or-histogram.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-large-v4.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/quick-start.html">Quick start</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/data-structures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/slicing.html">Slicing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/computation.html">Computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/masking.html">Masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/binned-data.html">Binned Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/groupby.html">GroupBy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/reading-and-writing-files.html">Reading and Writing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/how_to.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/tips-tricks-and-anti-patterns.html">Tips, tricks, and anti-patterns</a></li>
</ul>
<p class="caption"><span class="caption-text">Visualization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../visualization/representations-and-tables.html">Representations and Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/plotting-overview.html">Plotting Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/plotting-1d-data.html">Plotting 1-D data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/plotting-2d-data.html">Plotting 2-D data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/plotting-nd-data.html">Plotting N-D data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/customizing-figures.html">Customizing figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/datetime_handling.html">Datetime handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/introduction.html">1-D datasets and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/multi-d-datasets.html">Multi-dimensional datasets</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python-reference/api.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python-reference/api.html#creation-functions">Creation functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python-reference/api.html#free-functions">Free functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python-reference/dtype.html">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python-reference/units.html">Physical units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python-reference/error-propagation.html">Propagation of uncertainties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python-reference/runtime-configuration.html">Runtime Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tooling.html">Tooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding-conventions.html">Coding conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="how-to.html">How To…</a></li>
<li class="toctree-l1"><a class="reference internal" href="transform.html">Transforming data</a></li>
<li class="toctree-l1"><a class="reference internal" href="constructing_variables.html">C++ API for constructing variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable_implementation.html">Implementation of class Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="customizing.html">Customizing Scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture-decision-records.html">Architecture Decision Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mantid-framework">Mantid Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mantid-framework-deployment-procedure">Mantid Framework Deployment Procedure</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/about.html">About scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/whats-new.html">What’s new in scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/contributing.html">Contributing to scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/release-notes.html">Release Notes</a></li>
</ul>

            
          
    <div style="height: 32px; position: fixed; bottom: 0; left: 15px;">
      Select version:&nbsp;
      <select onchange="location = this.value;"
              style="height: 30px; color: #27a54b; background-color: #403d3d;
                    border: 0px; box-shadow: none;">
        <option value="https://scipp.github.io" selected>latest (unstable)</option>
        <option value="https://scipp.github.io/release/0.6.0">v0.6</option>
        <option value="https://scipp.github.io/release/0.5.0">v0.5</option>
        <option value="https://scipp.github.io/release/0.4.0">v0.4</option>
        <option value="https://scipp.github.io/release/0.3.0">v0.3</option>
      </select>
    </div>
  
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scipp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Deployment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/developer/deployment.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="deployment">
<span id="id1"></span><h1>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h1>
<p>The scipp project encompases a collection of packages in an ecosystem.
This documents the release/deployment process for each package.</p>
<div class="section" id="mantid-framework">
<h2>Mantid Framework<a class="headerlink" href="#mantid-framework" title="Permalink to this headline">¶</a></h2>
<p>Mantid is an optional runtime dependency for scippneutron and is utilised solely through its python api.
In practice it is an important component for using scippneutron for neutron scattering as it provides a number of key components, such as facility specific file loading.</p>
<p>For mac os and linux, <code class="docutils literal notranslate"><span class="pre">mantid-framework</span></code> conda packages can be produced and are placed in the anaconda <code class="docutils literal notranslate"><span class="pre">scipp</span></code> channel.
There is currently no windows package.</p>
<p><em>Key Locations</em></p>
<ul class="simple">
<li><p>Source code for <a class="reference external" href="https://github.com/mantidproject/mantid">mantid</a>.</p></li>
<li><p>Code for the <a class="reference external" href="https://github.com/scipp/mantid_framework_conda_recipe">recipe</a>.</p></li>
<li><p>CI <a class="reference external" href="https://dev.azure.com/scipp/mantid-framework-conda-recipe/_build">Azure pipelines</a>.</p></li>
<li><p>Publish location on <a class="reference external" href="https://anaconda.org/scipp/mantid-framework">Anaconda Cloud</a>.</p></li>
</ul>
<p>We have two azure piplelines for these packages.</p>
<p>Our first pipeline will build, test and publish a package to the <code class="docutils literal notranslate"><span class="pre">scipp</span></code> channel and is triggered by new tags in the <a class="reference external" href="https://github.com/scipp/mantid_framework_conda_recipe">recipe repository</a>.
Successful pipline execution pushes new packages to <a class="reference external" href="https://anaconda.org/scipp/mantid-framework">Anaconda Cloud</a>.
This is the release pipeline, and is the subject of the deployment procedure below.</p>
<p>Our second pipleline uses latest <code class="docutils literal notranslate"><span class="pre">main</span></code> of mantid to produce (but not publish) a nightly package.
This allows us to anticipate and correct problems we will encounter in new package generation, and ensures we can produce new packages at short notice against an evolving mantid target, while taking into account updated depenencies on conda.</p>
<div class="section" id="mantid-framework-deployment-procedure">
<h3>Mantid Framework Deployment Procedure<a class="headerlink" href="#mantid-framework-deployment-procedure" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Check the nightly build pipeline on azure and verify successful completion.
If they are not, investigate and fix problems there first.</p></li>
<li><p>Determine the git revision of mantid you wish to use.</p></li>
<li><p>Compute a version string for the revision using <code class="docutils literal notranslate"><span class="pre">tools/make_version.py</span></code> from the recipe repository.</p></li>
<li><p>From the recipe repository update <code class="docutils literal notranslate"><span class="pre">.azure-pipelines/release.yml</span></code> setting the <code class="docutils literal notranslate"><span class="pre">git_rev</span></code> and <code class="docutils literal notranslate"><span class="pre">mantid_ver</span></code> to match the two values from the previous steps.</p></li>
<li><p>Commit changes to recipe repository to master (peer review advisable).</p></li>
<li><p>Create a new annotated tag in the recipe repository to describe the release and its purppose</p></li>
<li><p>Push the tag to origin, which will trigger the tagged release pipeline</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As part of the <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code> step mantid’s imports are tested and the mantid-scipp interface is tested in <code class="docutils literal notranslate"><span class="pre">run_test.sh</span></code> <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html#run-test-script">(see conda docs)</a>. Packaging can therefore fail if mantid does not appear to work (import) or there are incompatibilities between scipp and mantid. The compatibility checks take the test code from the latest scippneutron. scippneutron itself is installed from the <code class="docutils literal notranslate"><span class="pre">scipp/label/dev</span></code> (dev) channel as part of the process. All this means that the package can fail generation at the final test stage (all within <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code>) despite <code class="docutils literal notranslate"><span class="pre">mantid-framework</span></code> itself building and packaging,  so check reasons for packaging failure by inspecting full log output on azure pipeline.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code> locally, ensure that <code class="docutils literal notranslate"><span class="pre">conda-build</span></code> is up to date (<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">update</span> <span class="pre">conda-build</span></code>). This can be a source of difference between what is observed on the CI (install fresh into clean conda env) and a potentially stale local environment. You should also ensure that the channel order specified is the same as is applied in the CI for your <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code> command. Refer to order applied in <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code> step in pipeline yaml file. Priority decreases from left to right in your command line argument order. You should also ensure that your local <cite>~/.condarc</cite> file does not prioritise any unexpected/conflicting channels and that flag settings such as <code class="docutils literal notranslate"><span class="pre">channel_priority:</span> <span class="pre">false</span></code> are not utilised. Note that you can set <code class="docutils literal notranslate"><span class="pre">--override-channels</span></code> to your <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code> command to prevent local <cite>.condarc</cite> files getting getting in the way.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../about/about.html" class="btn btn-neutral float-right" title="About scipp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="adr/0005-remove-need-for-bins-property-when-calling-bin-or-histogram.html" class="btn btn-neutral float-left" title="ADR 0005: Remove need for bins property when calling bin or histogram" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 Scipp contributors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    
    <style>
      .wy-nav-content { max-width: 1100px; }
    </style>
  

</body>
</html>